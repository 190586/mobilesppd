import { Component } from '@angular/core';
import { NavController, NavParams } from 'ionic-angular';
import { Camera, CameraOptions } from '@ionic-native/camera';
import { GlobalService } from '../../providers/services/global-service';
import { KegiatanService } from './../../providers/services/kegiatan-service';
import { Validators, FormBuilder, FormGroup } from '@angular/forms';

@Component({
  selector: 'page-camera',
  templateUrl: 'camera.html',
})
export class CameraPage {
  currentData:any = {};
  imgCam:any;
  uploadForm: FormGroup;
  constructor(
    public navCtrl: NavController, 
    public navParams: NavParams,
    private formBuilder: FormBuilder,
    private globalService:GlobalService,
    private kegiatanService:KegiatanService,
    private camera:Camera
  ) {
    this.imgCam = 'assets/icon/camera-icon.svg';
    //this.imgCam = 'data:image/jpeg;base64,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';
    if(this.navParams.get('item') != undefined){
      this.currentData = this.navParams.get('item');
      console.log(this.currentData);
    }
    this.uploadForm = this.formBuilder.group({
      caption: ['', Validators.required]
    });
  }

  ionViewDidLoad() {
    console.log('ionViewDidLoad CameraPage');
  }

  getPic(){
    const options: CameraOptions = {
      quality: 100,
      destinationType: this.camera.DestinationType.DATA_URL,
      encodingType: this.camera.EncodingType.JPEG,
      mediaType: this.camera.MediaType.PICTURE
    }
    this.camera.getPicture(options).then((imageData) => {
      // imageData is either a base64 encoded string or a file URI
      // If it's base64:
      let base64Image = 'data:image/jpeg;base64,' + imageData;
      this.imgCam = base64Image;
     }, (err) => {
      // Handle error
      this.globalService.presentToast(err);
     });
  }

  onSubmit(){
    let dataCam = this.uploadForm.value;
    let objData = {
      img:this.imgCam, 
      kegiatan_id:this.currentData.KEGIATAN_ID,
      kegiatan_detail_id:this.currentData.KEGIATAN_DETAIL_ID, 
      caption: dataCam.caption
    };
    console.log(objData);
    this.globalService.presentToast('Gambar berhasil diunggah!');
    this.navCtrl.pop();
  }

}
